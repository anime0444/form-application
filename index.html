const SPREADSHEET_ID = "1JWUk3vMzSG5BAljxRI8C5e0rhDsrUYuv0347YAcQABQ"; // هذا هو معرف Google Sheets
const SHEET_NAME = "BNM"; // اسم الورقة كما في الصورة

function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  const phone = data.phone;

  if (!phone) {
    return ContentService.createTextOutput("رقم الهاتف مفقود");
  }

  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME);
  const rows = sheet.getDataRange().getValues();

  for (let i = 1; i < rows.length; i++) {
    if (rows[i][0] == phone) {
      return ContentService.createTextOutput("مرحباً\nرقمك: " + phone + "\nرصيدك: " + rows[i][1] + " د");
    }
  }

  sheet.appendRow([phone, 0]);
  return ContentService.createTextOutput("تم إنشاء حساب جديد\nرقمك: " + phone + "\nرصيدك: 0 د");
}
